<app-header></app-header>

<div class="teacher-profile-container" *ngIf="teacher">
  <div class="profile-header">
    <div class="container">
      <div class="profile-info">
        <div class="profile-photo">
          <img [src]="placeholder.getImageUrl(teacher.photoUrl, 'avatar')" [alt]="getFullName(teacher)"
            (error)="onImageError($event)" />
        </div>
        <div class="profile-details">
          <div class="profile-title-row">
            <h1>{{ getFullName(teacher) }}</h1>
            <button *ngIf="isOwnProfile" class="btn-edit-profile" (click)="goToEditProfile()">
              <i class="fas fa-edit"></i>
              <span>Редактировать профиль</span>
            </button>
          </div>
          <p *ngIf="teacher.bio" class="bio">{{ teacher.bio }}</p>
          <div *ngIf="teacher.videoUrl" class="video-visitka">
            <div class="video-visitka-header" (click)="toggleVideo()">
              <h3><i class="fas fa-video"></i> Видео визитка</h3>
              <button class="video-toggle-btn" [class.expanded]="isVideoExpanded">
                <i class="fas" [class.fa-chevron-down]="!isVideoExpanded" [class.fa-chevron-up]="isVideoExpanded"></i>
              </button>
            </div>
            <div class="video-container" [class.expanded]="isVideoExpanded">
              <!-- YouTube -->
              <iframe *ngIf="isYouTubeUrl(teacher.videoUrl) && getYouTubeEmbedUrl(teacher.videoUrl)"
                [src]="getYouTubeEmbedUrl(teacher.videoUrl)!" frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen class="video-iframe"></iframe>
              <!-- Vimeo -->
              <iframe *ngIf="isVimeoUrl(teacher.videoUrl) && getVimeoEmbedUrl(teacher.videoUrl)"
                [src]="getVimeoEmbedUrl(teacher.videoUrl)!" frameborder="0"
                allow="autoplay; fullscreen; picture-in-picture" allowfullscreen class="video-iframe"></iframe>
              <!-- Прямые видео файлы - используем прокси URL для обхода CORS -->
              <video *ngIf="isDirectVideoFile(teacher.videoUrl) && getSafeVideoUrl(teacher.videoUrl)"
                [src]="getSafeVideoUrl(teacher.videoUrl)!" controls
                class="video-player"></video>
              <!-- Другие URL - пробуем показать как видео через прокси -->
              <video
                *ngIf="!isDirectVideoFile(teacher.videoUrl) && !isYouTubeUrl(teacher.videoUrl) && !isVimeoUrl(teacher.videoUrl) && getSafeVideoUrl(teacher.videoUrl)"
                [src]="getSafeVideoUrl(teacher.videoUrl)!" controls class="video-player"></video>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <nav class="profile-nav">
      <a [routerLink]="['/teacher', username, 'home']" routerLinkActive="active"
        [routerLinkActiveOptions]="{ exact: false }">
        <i class="fas fa-blog"></i> Мой блог
      </a>
      <a [routerLink]="['/teacher', username, 'master-classes']" routerLinkActive="active">
        <i class="fas fa-graduation-cap"></i> Мастер-классы
      </a>
      <a [routerLink]="['/teacher', username, 'publications']" routerLinkActive="active">
        <i class="fas fa-file-alt"></i> Публикации
      </a>
      <a [routerLink]="['/teacher', username, 'lessons']" routerLinkActive="active">
        <i class="fas fa-chalkboard-teacher"></i> Занятия
      </a>
      <a [routerLink]="['/teacher', username, 'certificates']" routerLinkActive="active">
        <i class="fas fa-certificate"></i> Сертификаты
      </a>
      <a [routerLink]="['/teacher', username, 'presentations']" routerLinkActive="active">
        <i class="fas fa-file-powerpoint"></i> Презентации
      </a>
      <a [routerLink]="['/teacher', username, 'parents']" routerLinkActive="active">
        <i class="fas fa-users"></i> Для родителей
      </a>
      <a [routerLink]="['/teacher', username, 'life']" routerLinkActive="active">
        <i class="fas fa-camera"></i> Жизнь в ДОУ
      </a>
      <a [routerLink]="['/teacher', username, 'contact']" routerLinkActive="active">
        <i class="fas fa-envelope"></i> Связь со мной
      </a>
      <a [routerLink]="['/teacher', username, 'reviews']" routerLinkActive="active">
        <i class="fas fa-star"></i> Отзывы
      </a>
    </nav>

    <div class="profile-content">
      <router-outlet></router-outlet>
    </div>
  </div>
</div>